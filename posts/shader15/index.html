<!doctype html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="shader入门基础-透明效果四" /><meta name="author" content="晓" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="开启深度写入的透明效果" /><meta property="og:description" content="开启深度写入的透明效果" /><link rel="canonical" href="https://lixiao90s.github.io/posts/shader15/" /><meta property="og:url" content="https://lixiao90s.github.io/posts/shader15/" /><meta property="og:site_name" content="晓的博客" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-30T10:36:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="shader入门基础-透明效果四" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@晓" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"晓"},"dateModified":"2020-04-30T10:36:00+08:00","datePublished":"2020-04-30T10:36:00+08:00","description":"开启深度写入的透明效果","headline":"shader入门基础-透明效果四","mainEntityOfPage":{"@type":"WebPage","@id":"https://lixiao90s.github.io/posts/shader15/"},"url":"https://lixiao90s.github.io/posts/shader15/"}</script><title>shader入门基础-透明效果四 | 晓的博客</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="晓的博客"><meta name="application-name" content="晓的博客"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/zh.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/sample/favicon.ico" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">晓的博客</a><p class="site-subtitle fst-italic mb-0">学习&工作记录</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>关于</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/lixiao90s" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['example','domain.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">首页</a> </span> <span>shader入门基础-透明效果四</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> 文章</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>shader入门基础-透明效果四</h1><div class="post-meta text-muted"> <span> 发表于 <time data-ts="1588214160" data-df="YYYY/MM/DD" data-bs-toggle="tooltip" data-bs-placement="bottom" > 2020/04/30 </time> </span><div class="d-flex justify-content-between"> <span> 作者 <em> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2584 字" > <em>14 分钟</em>阅读</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">shader入门基础-透明效果四</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">文章内容</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">shader入门基础-透明效果四</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="开启深度写入的透明效果"><span class="me-2">开启深度写入的透明效果</span><a href="#开启深度写入的透明效果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>由于关闭深度写入可能造成错误排序 <a href="/assets/img/sample/alphaBlendNoZwrite.png" class="popup img-link shimmer"><img src="/assets/img/sample/alphaBlendNoZwrite.png" alt="alphaBlendNoZwrite" loading="lazy"></a></p><p>解决方案:使用两个 pass 来渲染模型 第一个 pass 开启深度写入，但不输出颜色，目的仅仅是把该模型深度值写入到深度缓冲中。 第二个 pass 进行正常的透明度混合，由于上一个 pass 已经得到了逐像素的正确深度信息，该 pass 就可以额按照像素级别 的深度排序结果进行透明渲染。</p><p>缺点：多使用一个 pass 会对性能造成一定的影响。</p><p><strong>ColorMask</strong>: ColorMask RGB |A|0| 其他任何 R,G,B,A 的组合，ColorMask 会指定渲染结果的输出通道，而不是通常的 RGBA 四个通道都被写入。 可选参数为 RGBA 的任意组合以及 0，参数为 0 时，那么不会写入任何通道，但是会做一次深度测试，并将深度值写入深度缓冲区。这就是我们这个 pass 需要的，先做一次深度写入</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
</pre><td class="rouge-code"><pre><span class="n">Shader</span> <span class="s">"Practice/AlphaBlendZWrite"</span>
<span class="p">{</span>
    <span class="n">Properties</span>
    <span class="p">{</span>
        <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
        <span class="n">_Color</span><span class="p">(</span><span class="s">"Color Tint"</span><span class="p">,</span><span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_AlphaScale</span><span class="p">(</span><span class="s">"Alpha Cutoff"</span><span class="p">,</span><span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span>
    <span class="p">}</span>
    <span class="n">SubShader</span>
    <span class="p">{</span>
        <span class="c1">//RenderType 可以让unity把这个shader提前归入到“Transparent”组中</span>
        <span class="c1">//"IgnoreProjector"="True" 不受投影器影响</span>
        <span class="c1">//透明度混合使用的是 渲染序列是Transparent</span>
        <span class="n">Tags</span> <span class="p">{</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Transparent"</span> <span class="s">"IgnoreProjector"</span><span class="o">=</span><span class="s">"True"</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Transparent"</span> <span class="p">}</span>

        <span class="n">Pass</span>
        <span class="p">{</span>
            <span class="n">ZWrite</span> <span class="n">On</span>
            <span class="c1">// ColorMask 0 的时候不输出任何颜色通道，只会做一次深度测试，并写入到深度缓存中</span>
            <span class="n">ColorMask</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="n">Pass</span>
        <span class="p">{</span>
            <span class="c1">//LightModel 是 pass标签的一种，正确定义LightModel 才能正确得到unity的内置光照变量</span>
            <span class="n">Tags</span> <span class="p">{</span><span class="s">"LightModel"</span><span class="o">=</span><span class="s">"ForwardBase"</span><span class="p">}</span>
            <span class="c1">//关闭深度写入</span>
            <span class="n">ZWrite</span> <span class="n">Off</span>
            <span class="c1">//开启混合，等价于下列公式</span>
            <span class="c1">// O_rgb= srcAlpha*S_rgb+(1-srcAlpha)*D_rgb</span>
            <span class="c1">//O_a=srcAlpha*S_a+(1-srcAlpha)*D_a</span>
            <span class="c1">//这里可以合并rgb 和a，标量和矢量相乘</span>
            <span class="c1">//O_rgba = srcAlpha*S_rgba+(1-srcAlpha)*D_rgba</span>
            <span class="n">Blend</span> <span class="n">srcAlpha</span> <span class="n">OneMinusSrcAlpha</span>

            <span class="n">CGPROGRAM</span>
            <span class="cp">#pragma vertex vert
</span>            <span class="cp">#pragma fragment frag
</span>
            <span class="cp">#include</span> <span class="cpf">"UnityCG.cginc"</span><span class="cp">
</span>            <span class="c1">//包含内置变量的 _LightColor0</span>
            <span class="cp">#include</span> <span class="cpf">"Lighting.cginc"</span><span class="cp">
</span>            <span class="c1">//C_diffuse = (C_light·m_diffuse)max(0,N·L) //漫反射计算公式</span>
            <span class="c1">//都在unity 世界坐标计算，需要知道顶点在世界的位置，顶点法线，顶点视角位置</span>
            <span class="k">struct</span> <span class="n">appdata</span>
            <span class="p">{</span>
                <span class="n">float4</span> <span class="n">vertex</span> <span class="o">:</span> <span class="n">POSITION</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">normal</span> <span class="o">:</span> <span class="n">NORMAL</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">texcoord</span> <span class="o">:</span><span class="n">TEXCOORD0</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="k">struct</span> <span class="n">v2f</span>
            <span class="p">{</span>
                <span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD1</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">pos</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">worldNormal</span><span class="o">:</span><span class="n">NORMAL</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">worldPos</span><span class="o">:</span><span class="n">TEXCOORD2</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
            <span class="n">float4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>
            <span class="n">fixed4</span> <span class="n">_Color</span><span class="p">;</span>
            <span class="n">fixed</span> <span class="n">_AlphaScale</span><span class="p">;</span>

            <span class="n">v2f</span> <span class="n">vert</span> <span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
                <span class="n">o</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="c1">//把顶点坐标转换到世界坐标，为后续取 L做准备</span>
                <span class="n">o</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">unity_ObjectToWorld</span><span class="p">,</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="c1">//把法线转换到 世界空间中</span>
                <span class="n">o</span><span class="p">.</span><span class="n">worldNormal</span> <span class="o">=</span> <span class="n">UnityObjectToWorldNormal</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
                <span class="c1">//纹理映射坐标，该顶点在纹理中对应的2D坐标</span>
                <span class="n">o</span><span class="p">.</span><span class="n">uv</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">texcoord</span><span class="p">.</span><span class="n">xy</span><span class="o">*</span><span class="n">_MainTex_ST</span><span class="p">.</span><span class="n">xy</span><span class="o">+</span><span class="n">_MainTex_ST</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">fixed4</span> <span class="n">frag</span> <span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_Target</span>
            <span class="p">{</span>
                <span class="c1">//逐像素 光照</span>
                <span class="c1">//C_diffuse = (C_light·m_diffuse)max(0,N·L)</span>
                <span class="c1">//获取公式中的各个变量，m_diffuse =此时材质面板给定的_Color*顶点的color</span>
                <span class="n">fixed4</span> <span class="n">col</span><span class="p">;</span>
                <span class="n">fixed4</span> <span class="n">texColor</span> <span class="o">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
                <span class="n">fixed3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldNormal</span><span class="p">);</span>
                <span class="c1">//UnityWorldSpaceLightDir输入世界空间中的坐标点，WorldSpaceLightDir 输入模型空间中的坐标顶点</span>
                <span class="n">fixed3</span> <span class="n">L</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">UnityWorldSpaceLightDir</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">));</span>
                <span class="c1">//clip(texColor.a-_AlphaScale);</span>
                <span class="c1">//equal to</span>
                <span class="c1">//if(m_diffuse.a-_AlphaScale)&lt;0{</span>
                    <span class="c1">//discard;</span>
                <span class="c1">//}</span>
                <span class="c1">//计算漫反射部分</span>

                <span class="n">fixed3</span> <span class="n">c_light</span> <span class="o">=</span> <span class="n">_LightColor0</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="n">fixed3</span> <span class="n">m_diffuse</span> <span class="o">=</span><span class="n">texColor</span><span class="p">.</span><span class="n">rgb</span><span class="o">*</span><span class="n">_Color</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="n">fixed3</span> <span class="n">c_diffuse</span> <span class="o">=</span> <span class="n">c_light</span><span class="o">*</span><span class="n">m_diffuse</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">L</span><span class="p">));</span>
                <span class="c1">//计算环境光产生的影响,环境光反射的也会受材质本身颜色影响</span>
                <span class="n">fixed3</span> <span class="n">ambient</span> <span class="o">=</span> <span class="n">m_diffuse</span><span class="o">*</span><span class="n">UNITY_LIGHTMODEL_AMBIENT</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="c1">//环境光和漫反射光</span>
                <span class="c1">//只有使用Blend命令打开混合后，我们在这里设置透明通道才有意义，否则</span>
                <span class="c1">//这些透明度不会对片元透明效果有任何影响。</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">fixed4</span><span class="p">(</span><span class="n">ambient</span><span class="o">+</span><span class="n">c_diffuse</span><span class="p">,</span><span class="n">texColor</span><span class="p">.</span><span class="n">a</span><span class="o">*</span><span class="n">_AlphaScale</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">ENDCG</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">Fallback</span> <span class="s">"Transparent/VertexLit"</span>
<span class="p">}</span>

</pre></table></code></div></div><p>两个 pass，解决排序后的效果图 <a href="/assets/img/sample/alphaBlendZwrite.png" class="popup img-link shimmer"><img src="/assets/img/sample/alphaBlendZwrite.png" alt="alphaBlendZWrite" loading="lazy"></a></p><h2 id="双面渲染的透明效果"><span class="me-2">双面渲染的透明效果</span><a href="#双面渲染的透明效果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>Culll</strong> Cull Back|Front|Off 可以声依永 Cull 指令来控制需要剔除哪个面的渲染图元，默认设置为 Back ，那么那些背对着摄像机的渲染图元就不会被渲染， 设置 Front，朝向摄像机的渲染图元不会被渲染，设置 off 会关闭剔除功能，所有图元都会被渲染，这时需要渲染的图元数目会成倍增加，因此除非是用于特殊效果 ，例如这里的双面渲染的透明效果，通常情况下课不会关闭剔除功能。</p><h3 id="透明度测试的双面渲染"><span class="me-2">透明度测试的双面渲染</span><a href="#透明度测试的双面渲染" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>只需要在 Pass 的渲染设置中使用 Cull 指令来关闭剔除即可。</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> <span class="n">Pass</span>
        <span class="p">{</span>
            <span class="n">Tags</span><span class="p">{</span><span class="s">"LightModel"</span><span class="o">=</span><span class="s">"ForwardBase"</span><span class="p">}</span>
            <span class="n">Cull</span> <span class="n">Off</span>
        <span class="p">}</span>
</pre></table></code></div></div><h3 id="透明度混合的双面渲染"><span class="me-2">透明度混合的双面渲染</span><a href="#透明度混合的双面渲染" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>由于透明度混合会关闭深度写入，想要得到正确的透明效果，渲染顺序是非常重要的，我们需要保证图元从后往前渲染。为此我们选择把 双面渲染的工作分成两个 pass，第一个 Pass 只渲染背面，第二个 Pass 只渲染正面，<strong>Unity 会顺序执行 SubShader 中的各个 Pass，因此背面总是在正面之前渲染。</strong> 这里偷懒了，直接在原来的 shader 中复制，粘贴</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
</pre><td class="rouge-code"><pre><span class="n">Shader</span> <span class="s">"Practice/AlphaBlendZWrite"</span>
<span class="p">{</span>
    <span class="n">Properties</span>
    <span class="p">{</span>
        <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
        <span class="n">_Color</span><span class="p">(</span><span class="s">"Color Tint"</span><span class="p">,</span><span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_AlphaScale</span><span class="p">(</span><span class="s">"Alpha Cutoff"</span><span class="p">,</span><span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span>
    <span class="p">}</span>
    <span class="n">SubShader</span>
    <span class="p">{</span>
        <span class="c1">//RenderType 可以让unity把这个shader提前归入到“Transparent”组中</span>
        <span class="c1">//"IgnoreProjector"="True" 不受投影器影响</span>
        <span class="c1">//透明度混合使用的是 渲染序列是Transparent</span>
        <span class="n">Tags</span> <span class="p">{</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Transparent"</span> <span class="s">"IgnoreProjector"</span><span class="o">=</span><span class="s">"True"</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Transparent"</span> <span class="p">}</span>

       <span class="n">Pass</span>
        <span class="p">{</span>
            <span class="c1">//LightModel 是 pass标签的一种，正确定义LightModel 才能正确得到unity的内置光照变量</span>
            <span class="n">Tags</span> <span class="p">{</span><span class="s">"LightModel"</span><span class="o">=</span><span class="s">"ForwardBase"</span><span class="p">}</span>
            <span class="c1">//第一个Pass只渲染背面，剔除前面</span>
            <span class="n">Cull</span> <span class="n">Front</span>
            <span class="c1">//关闭深度写入</span>
            <span class="n">ZWrite</span> <span class="n">Off</span>
            <span class="c1">//开启混合，等价于下列公式</span>
            <span class="c1">// O_rgb= srcAlpha*S_rgb+(1-srcAlpha)*D_rgb</span>
            <span class="c1">//O_a=srcAlpha*S_a+(1-srcAlpha)*D_a</span>
            <span class="c1">//这里可以合并rgb 和a，标量和矢量相乘</span>
            <span class="c1">//O_rgba = srcAlpha*S_rgba+(1-srcAlpha)*D_rgba</span>
            <span class="n">Blend</span> <span class="n">srcAlpha</span> <span class="n">OneMinusSrcAlpha</span>

            <span class="n">CGPROGRAM</span>
            <span class="cp">#pragma vertex vert
</span>            <span class="cp">#pragma fragment frag
</span>
            <span class="cp">#include</span> <span class="cpf">"UnityCG.cginc"</span><span class="cp">
</span>            <span class="c1">//包含内置变量的 _LightColor0</span>
            <span class="cp">#include</span> <span class="cpf">"Lighting.cginc"</span><span class="cp">
</span>            <span class="c1">//C_diffuse = (C_light·m_diffuse)max(0,N·L) //漫反射计算公式</span>
            <span class="c1">//都在unity 世界坐标计算，需要知道顶点在世界的位置，顶点法线，顶点视角位置</span>
            <span class="k">struct</span> <span class="n">appdata</span>
            <span class="p">{</span>
                <span class="n">float4</span> <span class="n">vertex</span> <span class="o">:</span> <span class="n">POSITION</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">normal</span> <span class="o">:</span> <span class="n">NORMAL</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">texcoord</span> <span class="o">:</span><span class="n">TEXCOORD0</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="k">struct</span> <span class="n">v2f</span>
            <span class="p">{</span>
                <span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD1</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">pos</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">worldNormal</span><span class="o">:</span><span class="n">NORMAL</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">worldPos</span><span class="o">:</span><span class="n">TEXCOORD2</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
            <span class="n">float4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>
            <span class="n">fixed4</span> <span class="n">_Color</span><span class="p">;</span>
            <span class="n">fixed</span> <span class="n">_AlphaScale</span><span class="p">;</span>

            <span class="n">v2f</span> <span class="n">vert</span> <span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
                <span class="n">o</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="c1">//把顶点坐标转换到世界坐标，为后续取 L做准备</span>
                <span class="n">o</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">unity_ObjectToWorld</span><span class="p">,</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="c1">//把法线转换到 世界空间中</span>
                <span class="n">o</span><span class="p">.</span><span class="n">worldNormal</span> <span class="o">=</span> <span class="n">UnityObjectToWorldNormal</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
                <span class="c1">//纹理映射坐标，该顶点在纹理中对应的2D坐标</span>
                <span class="n">o</span><span class="p">.</span><span class="n">uv</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">texcoord</span><span class="p">.</span><span class="n">xy</span><span class="o">*</span><span class="n">_MainTex_ST</span><span class="p">.</span><span class="n">xy</span><span class="o">+</span><span class="n">_MainTex_ST</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">fixed4</span> <span class="n">frag</span> <span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_Target</span>
            <span class="p">{</span>
                <span class="c1">//逐像素 光照</span>
                <span class="c1">//C_diffuse = (C_light·m_diffuse)max(0,N·L)</span>
                <span class="c1">//获取公式中的各个变量，m_diffuse =此时材质面板给定的_Color*顶点的color</span>
                <span class="n">fixed4</span> <span class="n">col</span><span class="p">;</span>
                <span class="n">fixed4</span> <span class="n">texColor</span> <span class="o">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
                <span class="n">fixed3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldNormal</span><span class="p">);</span>
                <span class="c1">//UnityWorldSpaceLightDir输入世界空间中的坐标点，WorldSpaceLightDir 输入模型空间中的坐标顶点</span>
                <span class="n">fixed3</span> <span class="n">L</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">UnityWorldSpaceLightDir</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">));</span>
                <span class="c1">//clip(texColor.a-_AlphaScale);</span>
                <span class="c1">//equal to</span>
                <span class="c1">//if(m_diffuse.a-_AlphaScale)&lt;0{</span>
                    <span class="c1">//discard;</span>
                <span class="c1">//}</span>
                <span class="c1">//计算漫反射部分</span>

                <span class="n">fixed3</span> <span class="n">c_light</span> <span class="o">=</span> <span class="n">_LightColor0</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="n">fixed3</span> <span class="n">m_diffuse</span> <span class="o">=</span><span class="n">texColor</span><span class="p">.</span><span class="n">rgb</span><span class="o">*</span><span class="n">_Color</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="n">fixed3</span> <span class="n">c_diffuse</span> <span class="o">=</span> <span class="n">c_light</span><span class="o">*</span><span class="n">m_diffuse</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">L</span><span class="p">));</span>
                <span class="c1">//计算环境光产生的影响,环境光反射的也会受材质本身颜色影响</span>
                <span class="n">fixed3</span> <span class="n">ambient</span> <span class="o">=</span> <span class="n">m_diffuse</span><span class="o">*</span><span class="n">UNITY_LIGHTMODEL_AMBIENT</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="c1">//环境光和漫反射光</span>
                <span class="c1">//只有使用Blend命令打开混合后，我们在这里设置透明通道才有意义，否则</span>
                <span class="c1">//这些透明度不会对片元透明效果有任何影响。</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">fixed4</span><span class="p">(</span><span class="n">ambient</span><span class="o">+</span><span class="n">c_diffuse</span><span class="p">,</span><span class="n">texColor</span><span class="p">.</span><span class="n">a</span><span class="o">*</span><span class="n">_AlphaScale</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">ENDCG</span>
        <span class="p">}</span>

        <span class="n">Pass</span>
        <span class="p">{</span>
            <span class="c1">//LightModel 是 pass标签的一种，正确定义LightModel 才能正确得到unity的内置光照变量</span>
            <span class="n">Tags</span> <span class="p">{</span><span class="s">"LightModel"</span><span class="o">=</span><span class="s">"ForwardBase"</span><span class="p">}</span>
            <span class="c1">//第二个Pass只渲染前面，剔除背面</span>
            <span class="n">Cull</span> <span class="n">Back</span>
            <span class="c1">//关闭深度写入</span>
            <span class="n">ZWrite</span> <span class="n">Off</span>
            <span class="c1">//开启混合，等价于下列公式</span>
            <span class="c1">// O_rgb= srcAlpha*S_rgb+(1-srcAlpha)*D_rgb</span>
            <span class="c1">//O_a=srcAlpha*S_a+(1-srcAlpha)*D_a</span>
            <span class="c1">//这里可以合并rgb 和a，标量和矢量相乘</span>
            <span class="c1">//O_rgba = srcAlpha*S_rgba+(1-srcAlpha)*D_rgba</span>
            <span class="n">Blend</span> <span class="n">srcAlpha</span> <span class="n">OneMinusSrcAlpha</span>

            <span class="n">CGPROGRAM</span>
            <span class="cp">#pragma vertex vert
</span>            <span class="cp">#pragma fragment frag
</span>
            <span class="cp">#include</span> <span class="cpf">"UnityCG.cginc"</span><span class="cp">
</span>            <span class="c1">//包含内置变量的 _LightColor0</span>
            <span class="cp">#include</span> <span class="cpf">"Lighting.cginc"</span><span class="cp">
</span>            <span class="c1">//C_diffuse = (C_light·m_diffuse)max(0,N·L) //漫反射计算公式</span>
            <span class="c1">//都在unity 世界坐标计算，需要知道顶点在世界的位置，顶点法线，顶点视角位置</span>
            <span class="k">struct</span> <span class="n">appdata</span>
            <span class="p">{</span>
                <span class="n">float4</span> <span class="n">vertex</span> <span class="o">:</span> <span class="n">POSITION</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">normal</span> <span class="o">:</span> <span class="n">NORMAL</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">texcoord</span> <span class="o">:</span><span class="n">TEXCOORD0</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="k">struct</span> <span class="n">v2f</span>
            <span class="p">{</span>
                <span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD1</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">pos</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">worldNormal</span><span class="o">:</span><span class="n">NORMAL</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">worldPos</span><span class="o">:</span><span class="n">TEXCOORD2</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
            <span class="n">float4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>
            <span class="n">fixed4</span> <span class="n">_Color</span><span class="p">;</span>
            <span class="n">fixed</span> <span class="n">_AlphaScale</span><span class="p">;</span>

            <span class="n">v2f</span> <span class="n">vert</span> <span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
                <span class="n">o</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="c1">//把顶点坐标转换到世界坐标，为后续取 L做准备</span>
                <span class="n">o</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">unity_ObjectToWorld</span><span class="p">,</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="c1">//把法线转换到 世界空间中</span>
                <span class="n">o</span><span class="p">.</span><span class="n">worldNormal</span> <span class="o">=</span> <span class="n">UnityObjectToWorldNormal</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
                <span class="c1">//纹理映射坐标，该顶点在纹理中对应的2D坐标</span>
                <span class="n">o</span><span class="p">.</span><span class="n">uv</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">texcoord</span><span class="p">.</span><span class="n">xy</span><span class="o">*</span><span class="n">_MainTex_ST</span><span class="p">.</span><span class="n">xy</span><span class="o">+</span><span class="n">_MainTex_ST</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">fixed4</span> <span class="n">frag</span> <span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_Target</span>
            <span class="p">{</span>
                <span class="c1">//逐像素 光照</span>
                <span class="c1">//C_diffuse = (C_light·m_diffuse)max(0,N·L)</span>
                <span class="c1">//获取公式中的各个变量，m_diffuse =此时材质面板给定的_Color*顶点的color</span>
                <span class="n">fixed4</span> <span class="n">col</span><span class="p">;</span>
                <span class="n">fixed4</span> <span class="n">texColor</span> <span class="o">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
                <span class="n">fixed3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldNormal</span><span class="p">);</span>
                <span class="c1">//UnityWorldSpaceLightDir输入世界空间中的坐标点，WorldSpaceLightDir 输入模型空间中的坐标顶点</span>
                <span class="n">fixed3</span> <span class="n">L</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">UnityWorldSpaceLightDir</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">));</span>
                <span class="c1">//clip(texColor.a-_AlphaScale);</span>
                <span class="c1">//equal to</span>
                <span class="c1">//if(m_diffuse.a-_AlphaScale)&lt;0{</span>
                    <span class="c1">//discard;</span>
                <span class="c1">//}</span>
                <span class="c1">//计算漫反射部分</span>

                <span class="n">fixed3</span> <span class="n">c_light</span> <span class="o">=</span> <span class="n">_LightColor0</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="n">fixed3</span> <span class="n">m_diffuse</span> <span class="o">=</span><span class="n">texColor</span><span class="p">.</span><span class="n">rgb</span><span class="o">*</span><span class="n">_Color</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="n">fixed3</span> <span class="n">c_diffuse</span> <span class="o">=</span> <span class="n">c_light</span><span class="o">*</span><span class="n">m_diffuse</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">L</span><span class="p">));</span>
                <span class="c1">//计算环境光产生的影响,环境光反射的也会受材质本身颜色影响</span>
                <span class="n">fixed3</span> <span class="n">ambient</span> <span class="o">=</span> <span class="n">m_diffuse</span><span class="o">*</span><span class="n">UNITY_LIGHTMODEL_AMBIENT</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
                <span class="c1">//环境光和漫反射光</span>
                <span class="c1">//只有使用Blend命令打开混合后，我们在这里设置透明通道才有意义，否则</span>
                <span class="c1">//这些透明度不会对片元透明效果有任何影响。</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">fixed4</span><span class="p">(</span><span class="n">ambient</span><span class="o">+</span><span class="n">c_diffuse</span><span class="p">,</span><span class="n">texColor</span><span class="p">.</span><span class="n">a</span><span class="o">*</span><span class="n">_AlphaScale</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">ENDCG</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">Fallback</span> <span class="s">"Transparent/VertexLit"</span>
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/img/sample/bothside.png" class="popup img-link shimmer"><img src="/assets/img/sample/bothside.png" alt="BothSide" loading="lazy"></a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/unity/">unity</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/shader/" class="post-tag no-text-decoration" >shader</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=shader%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C%E5%9B%9B%20-%20%E6%99%93%E7%9A%84%E5%8D%9A%E5%AE%A2&url=https%3A%2F%2Flixiao90s.github.io%2Fposts%2Fshader15%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=shader%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C%E5%9B%9B%20-%20%E6%99%93%E7%9A%84%E5%8D%9A%E5%AE%A2&u=https%3A%2F%2Flixiao90s.github.io%2Fposts%2Fshader15%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Flixiao90s.github.io%2Fposts%2Fshader15%2F&text=shader%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C%E5%9B%9B%20-%20%E6%99%93%E7%9A%84%E5%8D%9A%E5%AE%A2" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="分享链接" data-title-succeed="链接已复制！" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">最近更新</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/2024-03-11-welcome/"></a><li class="text-truncate lh-lg"> <a href="/posts/thread1/">java - 基础知识</a><li class="text-truncate lh-lg"> <a href="/posts/free-cursor/">cursor白嫖</a><li class="text-truncate lh-lg"> <a href="/posts/designpattern4/">java - 设计模式-原型模式</a><li class="text-truncate lh-lg"> <a href="/posts/java1/">java - 类加载过程</a></ul></section><section><h2 class="panel-heading">热门标签</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/shader/">shader</a> <a class="post-tag btn btn-outline-primary" href="/tags/java/">java</a> <a class="post-tag btn btn-outline-primary" href="/tags/tree/">tree</a> <a class="post-tag btn btn-outline-primary" href="/tags/actor/">actor</a> <a class="post-tag btn btn-outline-primary" href="/tags/akka/">akka</a> <a class="post-tag btn btn-outline-primary" href="/tags/cursor/">cursor</a> <a class="post-tag btn btn-outline-primary" href="/tags/dots/">dots</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/hashmap/">hashmap</a> <a class="post-tag btn btn-outline-primary" href="/tags/linkedlist/">linkedlist</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">文章内容</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">相关文章</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/shader9/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1587967800" data-df="YYYY/MM/DD" > 2020/04/27 </time><h4 class="pt-0 my-2">shader入门基础-基础纹理</h4><div class="text-muted"><p>本文内容主要参考 《Unity shader 入门精要》一书，旨在总结所学知识与加深个人理解 光照模型实践,使用单张纹理代替漫反射颜色 高光公式 [\mathtt{c}{specular}=(\mathtt{c}{light}\cdot\mathtt{m}{specular})max(0,\vec n\cdot\vec h)^{m{gloss}} \qquad \vec h=\frac...</p></div></div></a></article><article class="col"> <a href="/posts/shader8/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1587953400" data-df="YYYY/MM/DD" > 2020/04/27 </time><h4 class="pt-0 my-2">shader入门基础-光照模型总结</h4><div class="text-muted"><p>本文内容主要参考 《Unity shader 入门精要》一书，旨在总结所学知识与加深个人理解，为了表示方便，与书中公式略有差别。 漫反射 漫反射光照符合 兰伯特定律：反射光线强度与法线表面和光源方向的夹角的余弦值成正比。 公式 \(\mathtt{c}_{diffuse}=(\mathtt{c}_{light}\cdot \mathtt{m}_{diffuse})max(0,\vec n...</p></div></div></a></article><article class="col"> <a href="/posts/shader7/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1580227200" data-df="YYYY/MM/DD" > 2020/01/29 </time><h4 class="pt-0 my-2">shader入门基础知识七</h4><div class="text-muted"><p>content cg 流程控制与循环 在前面的章节中shader 入门基础知识五提到过，cg 不支持 switch ，break,default,goto 等关键字，这里不再尝试，下面对 if else 和 for while 进行尝试。 如图，我们对于模型坐标小于 0 的地方给与红色，大于 0 的地方给与绿色，得到的是渐变从红到绿的颜色。 原因是片元着色器的输入是对着色器输出...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/shader14/" class="btn btn-outline-primary" aria-label="上一篇" ><p>shader入门基础-透明效果三</p></a> <a href="/posts/shader16/" class="btn btn-outline-primary" aria-label="下一篇" ><p>shader案例-LOGO 闪光</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/lixiao90s">晓</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。" >保留部分权利。</span></p><p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">热门标签</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/shader/">shader</a> <a class="post-tag btn btn-outline-primary" href="/tags/java/">java</a> <a class="post-tag btn btn-outline-primary" href="/tags/tree/">tree</a> <a class="post-tag btn btn-outline-primary" href="/tags/actor/">actor</a> <a class="post-tag btn btn-outline-primary" href="/tags/akka/">akka</a> <a class="post-tag btn btn-outline-primary" href="/tags/cursor/">cursor</a> <a class="post-tag btn btn-outline-primary" href="/tags/dots/">dots</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/hashmap/">hashmap</a> <a class="post-tag btn btn-outline-primary" href="/tags/linkedlist/">linkedlist</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">发现新版本的内容。</p><button type="button" class="btn btn-primary" aria-label="Update"> 更新 </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
